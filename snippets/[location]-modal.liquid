{% assign custom = true %}
{% assign countrymap = '
GB en en,
SE se sv-se,
DE de de-de,
NO no no-no,
FR fr fr-fr,
NL nl nl-nl,
BE nl nl-be show,
BE fr fr-be show,
AT de de-at show,
ES es es-es' %}
<noscript>
    {%- form 'localization', id: 'FooterCountryFormNoScript', class: 'localization-form' -%}
        <div class="localization-form__select">
            <h2 class="visually-hidden" id="FooterCountryLabelNoScript">{{ 'localization.country_label'  | t }}</h2>
            <select aria-labelledby="FooterCountryLabelNoScript" class="localization-selector link" name="country_code">
                {%- for country in localization.available_countries -%}
                    <option value="{{ country.iso_code }}" {%- if country.iso_code==localization.country.iso_code %} selected {% endif %}>
                        {{ country.name | capitalize}}
                        ({{ country.currency.iso_code }}
                        {{ country.currency.symbol }})
                    </option>
                {%- endfor -%}
            </select>
            <svg aria-hidden="true" class="icon icon-caret tw-text-sm" focusable="false" height="1em" role="presentation" viewbox="0 0 10 6" width="1em">
                <path clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill-rule="evenodd" fill="currentColor"/>
            </svg>
        </div>
        <button class="button button--tertiary">{{ 'localization.update_country' | t }}</button>
    {%- endform -%}
</noscript>
<localization-form>
    {%- form 'localization', id: 'FooterCountryForm', class: 'localization-form' -%}

        <input class="tw-modal-toggle" id="footercountryformmodal" type="checkbox">
        <div class="tw-modal">
            <div class="tw-p-0 tw-modal-box lg:tw-max-w-xs">
                {% if custom %}
                    <div class="tw-w-full  tw-p-8 tw-pt-12 tw-max-h-[calc(100vh-100px)] tw-overflow-auto">
                        <div class="tw-p-0 !tw-transition-all    !tw-relative tw-w-full lg:tw-ml-auto tw-bg-base-100 " id="FooterLanguageList" role="list">
                            {% assign contrylangs = countrymap | split: ',' %}
                            {%- for contrylang in contrylangs -%}
                                {% assign contrylangarray = contrylang | split: ' ' %}
                                {% assign contrycode = contrylangarray[0] %}
                                {% assign langcode = contrylangarray[1] %}
                                {% assign path = contrylangarray[2] %}
                                {% assign show = contrylangarray[3] %}
                                {% assign country =  localization.available_countries | where: "iso_code", contrycode | first %}
                                {% unless country %}
                                    {% continue %}
                                {% endunless %}
                                {% assign lang =  localization.available_languages | where: "iso_code", langcode | first | default: localization.language  %}
                                <a href="/{{path}}" class=" tw-items-center tw-capitalize tw-flex tw-justify-between !tw-px-3 !tw-py-1 tw-gap-2  hover:tw-bg-gray-200 {% if country.iso_code == localization.country.iso_code %} tw-font-bold{% endif %} focus-inset" href="#" {% if country.iso_code == localization.country.iso_code %} aria-current="true" {% endif %} data-country="{{ country.iso_code }}" data-lang="{{ lang.iso_code }}" data-value="{{ country.iso_code }}">
                                    {{ country.name | capitalize }}
                                    {% if show %}
                                        ({{lang.name | capitalize}})
                                    {% endif %}
                                    {%- assign iconPath =  country.iso_code | downcase | append:'-flag' | append: '.svg' %}
                                    <img width="16" height="16" class="tw-w-4 tw-h-4 tw-rounded-full tw-object-cover" src="{{ iconPath | file_url}}"/>
                                </a>
                            {%- endfor -%}
                        </div>
                    </div>
                {% else %}
                    <div class="tw-w-full  tw-p-8 tw-pt-12 tw-max-h-[calc(100vh-100px)] tw-overflow-auto">
                        <div class="no-js-hidden tw-flex tw-justify-center lg:tw-justify-start">
                            <div class="tw-w-full">
                                <h3 class=" tw-text-center tw-mx-auto">
                                    {{'strings.general.change-shipping-country-and-language' | t}}
                                </h3>
                                <div class="no-js-hidden tw-pt-6 tw-flex tw-flex-col">
                                    <div class="tw-dropdown tw-w-full tw-group">
                                        <div aria-controls="FooterLanguageList" aria-describedby="FooterLanguageLabel" aria-expanded="false" class="tw-btn tw-btn-block tw-btn-outline tw-rounded-none tw-items-center tw-gap-3" tabindex="0" type="button">
                                            {%- assign iconPath =  localization.country.iso_code | downcase | append:'-flag' | append: '.svg' %}
                                            <img width="16" height="16" class="tw-w-4 tw-h-4 tw-rounded-full tw-object-cover" src="{{ iconPath | file_url}}"/>
                                            {{ localization.country.name | capitalize }}
                                            ({{ localization.country.currency.iso_code }}
                                            {{ localization.country.currency.symbol }})
                                            <svg aria-hidden="true" class="icon icon-caret tw-text-sm tw-ml-3" focusable="false" height="1em" role="presentation" viewbox="0 0 10 6" width="1em">
                                                <path clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill-rule="evenodd" fill="currentColor"/>
                                            </svg>
                                        </div>
                                        <ul class="tw-p-0 !tw-transition-all  tw-max-h-0 group-focus-within:tw-max-h-96 group-focus-within:tw-h-auto tw-overflow-auto !tw-relative tw-w-full tw-border tw-shadow-lg tw-menu lg:tw-ml-auto tw-dropdown-content tw-bg-base-100 tw-rounded-lg" hidden id="FooterLanguageList" role="list">
                                            {% assign countryListString = 'GB,SE,NO,DE,BE,FR'%}
                                            {%- for country in localization.available_countries -%}
                                                {% if countryListString contains country.iso_code %}
                                                    <li class="" tabindex="-1">
                                                        <div class="tw-px-3 tw-items-center tw-flex tw-gap-2 tw-py-1 hover:tw-bg-gray-200 {% if country.iso_code == localization.country.iso_code %} tw-font-bold{% endif %} focus-inset" href="#" {% if country.iso_code == localization.country.iso_code %} aria-current="true" {% endif %} data-country="{{ country.iso_code }}" data-value="{{ country.iso_code }}">
                                                            {%- assign iconPath =  country.iso_code | downcase | append:'-flag' | append: '.svg' %}
                                                            <img width="16" height="16" class="tw-w-4 tw-h-4 tw-rounded-full tw-object-cover" src="{{ iconPath | file_url}}"/>
                                                            {{ country.name | capitalize }}
                                                            ({{ country.currency.iso_code }}
                                                            {{ country.currency.symbol }})
                                                        </div>

                                                    </li>
                                                {% endif %}
                                            {%- endfor -%}
                                        </ul>
                                    </div>
                                    <div class="tw-dropdown tw-w-full tw-group">
                                        <div aria-controls="FooterLangList" aria-describedby="FooterLangListLabel" aria-expanded="false" class="tw-btn tw-btn-block tw-btn-outline tw-rounded-none tw-items-center tw-gap-3" tabindex="0" type="button">
                                            {{ localization.language.endonym_name | capitalize }}
                                            <svg aria-hidden="true" class="icon icon-caret tw-text-sm tw-ml-3" focusable="false" height="1em" role="presentation" viewbox="0 0 10 6" width="1em">
                                                <path clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill-rule="evenodd" fill="currentColor"/>
                                            </svg>
                                        </div>
                                        <ul class="tw-p-0 tw-block !tw-transition-all  tw-max-h-0 group-focus-within:tw-max-h-96 group-focus-within:tw-h-auto tw-overflow-auto !tw-relative tw-w-full tw-border tw-shadow-lg tw-menu lg:tw-ml-auto tw-dropdown-content tw-bg-base-100 tw-rounded-lg" hidden id="FooterLanguageList" role="list">
                                            {%- for language in localization.available_languages -%}
                                                <li class="" tabindex="-1">
                                                    <div class="tw-px-3 tw-items-center tw-flex tw-gap-2 tw-py-1 hover:tw-bg-gray-200 {% if language.iso_code == localization.language.iso_code %} tw-font-bold{% endif %} focus-inset" href="#" hreflang="{{ language.iso_code }}" lang="{{ language.iso_code }}" {% if language.iso_code == localization.language.iso_code %} aria-current="true" {% endif %} data-lang="{{ language.iso_code }}" data-value="{{ language.iso_code }}">
                                                        {{ language.name | capitalize }}
                                                        -
                                                        {{ language.endonym_name | capitalize }}
                                                    </div>
                                                </li>
                                            {%- endfor -%}

                                        </ul>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <!-- <div class="tw-modal-action tw-w-full">
                                                <button class="tw-btn tw-btn-block" for="footercountryformmodal">{{'strings.general.apply' | t }}</button>
                                            </div> -->
                    </div>
                {% endif %}

                <label class="tw-btn tw-btn-square tw-btn-ghost tw-bg-white tw-bg-opacity-30 tw-rounded-box tw-border-none tw-absolute tw-top-0 tw-right-0" for="footercountryformmodal">
                    <svg aria-hidden="true" class="icon icon-close-small" fill="none" focusable="false" height="2em" role="presentation" viewbox="0 0 12 13" width="2em" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8.48627 9.32917L2.82849 3.67098" stroke-linecap="round" stroke-linejoin="round" stroke="#333030"/>
                        <path d="M2.88539 9.38504L8.42932 3.61524" stroke-linecap="round" stroke-linejoin="round" stroke="#333030"/>
                    </svg>
                </label>
            </div>
        </div>

        <input type="hidden" name="country_code" value="{{ localization.country.iso_code }}">
        <input type="hidden" name="locale_code" value="{{ localization.language.iso_code }}"/>
    {%- endform -%}
</localization-form>

<script>

    class LocalizationForm extends HTMLElement {
        constructor() {
            super();
            this.elements = {
                inputlocalecode: this.querySelector("input[name=\"locale_code\"]"),
                inputcountrycode: this.querySelector("input[name=\"country_code\"]"),
                panel: this.querySelector("ul")
            };
            this.querySelectorAll("li div").forEach(item => item.addEventListener("click", this.onItemClick.bind(this)));
        }

        onItemClick(event) {
            event.preventDefault();
            const form = this.querySelector("form");
            if (event
                    .currentTarget
                    .dataset
                    .lang) {
                this
                    .elements
                    .inputlocalecode
                    .value = event
                    .currentTarget
                    .dataset
                    .lang;
            }
            if (event
                    .currentTarget
                    .dataset
                    .country) {
                this
                    .elements
                    .inputcountrycode
                    .value = event
                    .currentTarget
                    .dataset
                    .country;
            }
            form.submit();
        }
    }

    customElements.define("localization-form", LocalizationForm);
</script>